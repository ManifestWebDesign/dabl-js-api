function isArray(a){return"[object Array]"===Object.prototype.toString.call(a)}function foreach(a,b){if(isArray(a))for(var c=0;c<a.length;c++)b(a[c]);else b(a)}function D(a){var b="pending",c=[],d=[],e=[],f=null,g={done:function(){for(var a=0;a<arguments.length;a++)if(arguments[a])if(isArray(arguments[a]))for(var d=arguments[a],e=0;e<d.length;e++)"resolved"===b&&d[e].apply(this,f),c.push(d[e]);else"resolved"===b&&arguments[a].apply(this,f),c.push(arguments[a]);return this},fail:function(){for(var a=0;a<arguments.length;a++)if(arguments[a])if(isArray(arguments[a]))for(var c=arguments[a],e=0;e<c.length;e++)"rejected"===b&&c[e].apply(this,f),d.push(c[e]);else"rejected"===b&&arguments[a].apply(this,f),d.push(arguments[a]);return this},always:function(){return this.done.apply(this,arguments).fail.apply(this,arguments)},progress:function(){for(var a=0;a<arguments.length;a++)if(arguments[a])if(isArray(arguments[a]))for(var c=arguments[a],d=0;d<c.length;d++)"pending"===b&&e.push(c[d]);else"pending"===b&&e.push(arguments[a]);return this},then:function(){return arguments.length>1&&arguments[1]&&this.fail(arguments[1]),arguments.length>0&&arguments[0]&&this.done(arguments[0]),arguments.length>2&&arguments[2]&&this.progress(arguments[2]),this},promise:function(a){if(null==a)return g;for(var b in g)a[b]=g[b];return a},state:function(){return b},debug:function(){console.log("[debug]",c,d,b)},isRejected:function(){return"rejected"===b},isResolved:function(){return"resolved"===b},pipe:function(a,b,c){return D(function(c){foreach(a,function(a){"function"==typeof a?h.done(function(){var b=a.apply(this,arguments);b&&"function"==typeof b?b.promise().then(c.resolve,c.reject,c.notify):c.resolve(b)}):h.done(c.resolve)}),foreach(b,function(a){"function"==typeof a?h.fail(function(){var b=a.apply(this,arguments);b&&"function"==typeof b?b.promise().then(c.resolve,c.reject,c.notify):c.reject(b)}):h.fail(c.reject)})}).promise()}},h={resolveWith:function(a){if("pending"===b){b="resolved";for(var d=f=arguments.length>1?arguments[1]:[],e=0;e<c.length;e++)c[e].apply(a,d)}return this},rejectWith:function(a){if("pending"===b){b="rejected";for(var c=f=arguments.length>1?arguments[1]:[],e=0;e<d.length;e++)d[e].apply(a,c)}return this},notifyWith:function(a){if("pending"===b)for(var c=f=arguments.length>1?arguments[1]:[],d=0;d<e.length;d++)e[d].apply(a,c);return this},resolve:function(){return this.resolveWith(this,arguments)},reject:function(){return this.rejectWith(this,arguments)},notify:function(){return this.notifyWith(this,arguments)}},i=g.promise(h);return a&&a.apply(i,[i]),i}function extend(a,b,c){var d;for(d in a)b[d]="function"==typeof a[d]&&"function"==typeof c[d]&&fnTest.test(a[d])?function(a,b){return function(){var d,e=this._super;return this._super=c[a],d=b.apply(this,arguments),this._super=e,d}}(d,a[d]):a[d]}function doesDefinePropertyWork(a){try{return Object.defineProperty(a,"sentinel",{value:"foo"}),"sentinel"in a}catch(b){return!1}}function encodeUriSegment(a){return encodeUriQuery(a,!0).replace(/%26/gi,"&").replace(/%3D/gi,"=").replace(/%2B/gi,"+")}function encodeUriQuery(a,b){return encodeURIComponent(a).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(b?null:/%20/g,"+")}function Route(a,b){this.template=a,this.defaults=b||{};for(var c=this.urlParams={},d=a.split(/\W/),e=0,f=d.length;f>e;++e){var g=d[e];!new RegExp("^\\d+$").test(g)&&g&&new RegExp("(^|[^\\\\]):"+g+"(\\W|$)").test(a)&&(c[g]=!0)}this.template=a.replace(/\\:/g,":")}dabl="undefined"==typeof dabl?{}:dabl,dabl.sPad=function(a){return a+="",2===a.length?a:"0"+a},dabl.copy=function(a){if(null===a)return null;if(a instanceof Model)return a.constructor(a);if(a instanceof Array)return a.slice(0);if(a instanceof Date)return new Date(a.getTime());switch(typeof a){case"string":case"boolean":case"number":case"undefined":case"function":return a}var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},dabl.equals=function(a,b,c){if(c&&c===Model.FIELD_TYPE_DATE?(a=dabl.formatDate(a),b=dabl.formatDate(b)):c&&c===Model.FIELD_TYPE_TIMESTAMP&&(a=dabl.constructDate(a),b=dabl.constructDate(b)),a instanceof Date&&b instanceof Date)return a.getTime()===b.getTime();if(c&&c===JSON)"string"!=typeof a&&(a=JSON.stringify(a)),"string"!=typeof b&&(b=JSON.stringify(b));else if("object"==typeof a)return JSON.stringify(a)===JSON.stringify(b);return a===b},dabl.formatDate=function(a){return a instanceof Date||(a=dabl.constructDate(a)),a?a.getUTCFullYear()+"-"+dabl.sPad(a.getUTCMonth()+1)+"-"+dabl.sPad(a.getUTCDate()):null},dabl.constructDate=function(a){if(a===!1||""===a||"undefined"==typeof a)return null;if(a instanceof Date)return a;var b=new Date(a);if(isNaN(b.getTime()))throw new Error(a+" is not a valid date");return b},dabl.serialize=function(a,b){var c=[];for(var d in a)if(a.hasOwnProperty(d)){var e=b?b+"["+d+"]":d,f=a[d];c.push("object"==typeof f?dabl.serialize(f,e):encodeURIComponent(e)+"="+encodeURIComponent(f))}return c.join("&")},"undefined"!=typeof jQuery&&jQuery.Deferred?dabl.Deferred=jQuery.Deferred:(D.when=function(){if(arguments.length<2){var a=arguments.length?arguments[0]:void 0;return a&&"function"==typeof a.isResolved&&"function"==typeof a.isRejected?a.promise():D().resolve(a).promise()}return function(a){for(var b=D(),c=a.length,d=0,e=new Array(c),f=0;f<a.length;f++)!function(f){a[f].done(function(){e[f]=arguments.length<2?arguments[0]:arguments,++d===c&&b.resolve.apply(b,e)}).fail(function(){b.reject(arguments)})}(f);return b.promise()}(arguments)},dabl.Deferred=D);var initializing=!1,fnTest=/xyz/.test(function(){})?/\b_super\b/:/.*/,Class=function(){};Class.canDefineProperties=doesDefinePropertyWork({}),Class.extend=function(a,b){function c(){!initializing&&this.init&&this.init.apply(this,arguments)}"undefined"==typeof a&&(a={}),"undefined"==typeof b&&(b={});var d,e;initializing=!0,d=new this,initializing=!1;for(e in this)e in b||!this.hasOwnProperty(e)||(c[e]=this[e]);return extend(a,d,this.prototype),extend(b,c,this),c.prototype=d,c.prototype.constructor=c,c},Class.callAsync=Class.prototype.callAsync=function(a,b,c){var d=dabl.Deferred(),e=d.promise();try{var f=a.call(this);f&&"function"==typeof f.then?e=f:d.resolve(f)}catch(g){d.reject(g)}return("function"==typeof b||"function"==typeof c)&&e.then(b,c),e},dabl.Class=Class;var Model=dabl.Class.extend({_oldValues:null,_isNew:!0,_validationErrors:null,init:function(a){this._validationErrors=[];var b={},c=this.constructor;for(var d in c._fields){var e=c._fields[d];"undefined"!=typeof e.value?b[d]=dabl.copy(e.value):e.type===Array?b[d]=[]:b[d]=null}this.fromJSON(b),this.resetModified(),a&&this.fromJSON(a)},toString:function(){return this.constructor._table+":"+JSON.stringify(this.toJSON())},copy:function(){var a=this.constructor,b=new a(this),c=a.getKey();return c&&(b[c]=null),b},isModified:function(a){if(a){var b=this.constructor.getFieldType(a);return!dabl.equals(this[a],this._oldValues[a],b)}for(var a in this.constructor._fields)if(this.isModified(a))return!0;return!1},getModified:function(){var a={};for(var b in this.constructor._fields)this.isModified(b)&&(a[b]=!0);return a},resetModified:function(){return this._oldValues=JSON.parse(JSON.stringify(this)),this},revert:function(){return this.fromJSON(this._oldValues),this.resetModified(),this},fromJSON:function(a){var b=this.constructor;for(var c in b._fields)c in a&&(this[c]=a[c]);return b.coerceValues(this),this},toJSON:function(){var a,b,c,d={},e=this.constructor,f=e._fields;if(this._inToJSON)return null;this._inToJSON=!0,e.coerceValues(this);for(a in f){if(b=this[a],c=f[a].type,b instanceof Array){for(var g=[],h=0,i=b.length;i>h;++h)null!==b[h]&&"function"==typeof b[h].toJSON?g[h]=b[h].toJSON():g[h]=dabl.copy(b[h]);b=g}else b=c===JSON?JSON.stringify(b):c===Model.FIELD_TYPE_DATE?dabl.formatDate(b):null!==b&&"function"==typeof b.toJSON?b.toJSON():dabl.copy(b);d[a]=b}return delete this._inToJSON,d},hasKeyValues:function(){var a=this.constructor,b=a._keys;if(0===b.length)return!1;a.coerceValues(this);for(var c=0,d=b.length;d>c;++c){var e=b[c];if(null===this[e])return!1}return!0},getKeyValues:function(){var a={},b=this.constructor,c=b._keys;b.coerceValues(this);for(var d=0,e=c.length;e>d;++d){var f=c[d];a[f]=this[f]}return a},isNew:function(){return this._isNew},setNew:function(a){return this._isNew=a===!0,this},validate:function(){this._validationErrors=[];var a=this.constructor;a.coerceValues(this);for(var b in a._fields){var c=a._fields[b];if(c.required){var d=this[b];(!d||d instanceof Array&&0===d.length)&&this._validationErrors.push(b+" is required.")}}return 0===this._validationErrors.length},getValidationErrors:function(){return this._validationErrors},save:function(a,b){return this.isNew()?this.insert(a,b):this.update(a,b)},insert:function(a,b){return this.callAsync(function(){var a=this.constructor;if(!this.validate())throw new Error("Cannot save "+a._table+" with validation errors:\n"+this.getValidationErrors().join("\n"));return this.isNew()&&a.hasField("created")&&!this.isModified("created")&&(this.created=new Date),(this.isNew()||this.isModified())&&a.hasField("updated")&&!this.isModified("updated")&&(this.updated=new Date),this.constructor._adapter.insert(this)},a,b)},update:function(a,b,c){return"function"==typeof a&&(b=a,c=b),this.callAsync(function(){var b=this.constructor;if(!this.validate())throw new Error("Cannot save "+b._table+" with validation errors:\n"+this.getValidationErrors().join("\n"));if(0===b._keys.length)throw new Error("Cannot update without primary keys");return this.isNew()&&b.hasField("created")&&!this.isModified("created")&&(this.created=new Date),(this.isNew()||this.isModified())&&b.hasField("updated")&&!this.isModified("updated")&&(this.updated=new Date),"object"==typeof a&&this.fromJSON(a),b._adapter.update(this)},b,c)},remove:function(a,b){return this.callAsync(function(){return this.constructor._adapter.remove(this)},a,b)}});Model.models={},Model._fields=Model._keys=Model._table=null,Model._autoIncrement=!1,Model.FIELD_TYPE_TEXT="TEXT",Model.FIELD_TYPE_NUMERIC="NUMERIC",Model.FIELD_TYPE_INTEGER="INTEGER",Model.FIELD_TYPE_DATE="DATE",Model.FIELD_TYPE_TIME="TIME",Model.FIELD_TYPE_TIMESTAMP="TIMESTAMP",Model.FIELD_TYPES={TEXT:Model.FIELD_TYPE_TEXT,NUMERIC:Model.FIELD_TYPE_NUMERIC,INTEGER:Model.FIELD_TYPE_INTEGER,DATE:Model.FIELD_TYPE_DATE,TIME:Model.FIELD_TYPE_TIME,TIMESTAMP:Model.FIELD_TYPE_TIMESTAMP},Model.TEXT_TYPES={TEXT:Model.FIELD_TYPE_TEXT,DATE:Model.FIELD_TYPE_DATE,TIME:Model.FIELD_TYPE_TIME,TIMESTAMP:Model.FIELD_TYPE_TIMESTAMP},Model.INTEGER_TYPES={INTEGER:Model.FIELD_TYPE_INTEGER},Model.TEMPORAL_TYPES={DATE:Model.FIELD_TYPE_DATE,TIME:Model.FIELD_TYPE_TIME,TIMESTAMP:Model.FIELD_TYPE_TIMESTAMP},Model.NUMERIC_TYPES={INTEGER:Model.FIELD_TYPE_INTEGER,NUMERIC:Model.FIELD_TYPE_NUMERIC},Model.isFieldType=function(a){return a in Model.FIELD_TYPES||this.isObjectType(a)},Model.isTemporalType=function(a){return a in this.TEMPORAL_TYPES},Model.isTextType=function(a){return a in this.TEXT_TYPES},Model.isNumericType=function(a){return a in this.NUMERIC_TYPES},Model.isIntegerType=function(a){return a in this.INTEGER_TYPES},Model.isObjectType=function(a){return a===JSON||"function"==typeof a},Model.coerceValue=function(a,b){var c=b.type;if("undefined"==typeof a||null===a){if(c!==Array)return null;a=[]}var d=this.isTemporalType(c),e=this.isNumericType(c);if((e||d)&&""===a)return null;if(e){if(this.isIntegerType(c)){if(a=parseInt(a,10),isNaN(a))throw new Error(a+" is not a valid integer")}else if(a=parseFloat(a,10),isNaN(a))throw new Error(a+" is not a valid float")}else if(d)a instanceof Date||(a=dabl.constructDate(a));else if(c===Array){if(b.elementType){this.convertArray(a,b.elementType);for(var f=0,g=a.length;g>f;++f)a[f]=this.coerceValue(a[f],{type:b.elementType})}}else c===JSON?"string"==typeof a&&(a=JSON.parse(a)):c===this.FIELD_TYPE_TEXT?"string"!=typeof a&&(a+=""):this.isObjectType(c)&&c.isModel&&a.constructor!==c&&(a=c.inflate(a));return a},Model.coerceValues=function(a){if(null===a||"undefined"==typeof a)return this;for(var b in this._fields)b in a&&(a[b]=this.coerceValue(a[b],this._fields[b]));return this},Model.convertArray=function(a,b){if(!a.modelCollection){a.modelCollection=!0;var c=this;a.push=function(){return Array.prototype.push.apply(this,c.coerceValue(arguments,{type:Array,elementType:b}))},a.unshift=function(){return Array.prototype.unshift.apply(this,c.coerceValue(arguments,{type:Array,elementType:b}))},a.pop=function(){return c.coerceValue(Array.prototype.pop.apply(this,arguments),{type:b})},a.shift=function(){return c.coerceValue(Array.prototype.shift.apply(this,arguments),{type:b})},a.slice=function(){return c.coerceValue(Array.prototype.slice.apply(this,arguments),{type:Array,elementType:b})},a.concat=function(){return c.coerceValue(Array.prototype.concat.apply(this,arguments),{type:Array,elementType:b})},a.splice=function(){for(var a=2,d=arguments.length;d>a;++a)arguments[a]=c.coerceValue(arguments[a],{type:b});return c.coerceValue(Array.prototype.splice.apply(this,arguments),{type:Array,elementType:b})};for(var d=["forEach","every","some","filter","map"],e=0,f=d.length;f>e;++e){var g=d[e];a[g]=function(a){return function(d,e){return Array.prototype[a].call(this,function(){return arguments[0]=c.coerceValue(arguments[0],{type:b}),d.apply(this,arguments)},e)}}(g)}}},Model.getAdapter=function(){return this._adapter},Model.setAdapter=function(a){return this._adapter=a,this},Model.inflate=function(a){var b,c=this.getKey(),d=this._adapter;if(c&&a[c]&&(b=d.cache(this._table,a[c]))){if(b.isModified())return b;b.fromJSON(a)}return b||(b=new this(a)),b.resetModified().setNew(!1),c&&b[c]&&d.cache(this._table,b[c],b),b},Model.inflateArray=function(a){var b,c,d;if(a.constructor!==Array){if("undefined"==typeof d.length)throw new Error("Unknown array type for collection.");d=[]}else d=a;for(b=0,c=a.length;c>b;++b)d[b]=this.inflate(a[b]);return this.convertArray(d,this),d},Model.getTableName=function(){return this._table},Model.getFields=function(){return dabl.copy(this._fields)},Model.getField=function(a){return dabl.copy(this._fields[a])},Model.getFieldType=function(a){return this._fields[a].type},Model.hasField=function(a){return a in this._fields},Model.getKeys=function(){return this._keys.slice(0)},Model.getKey=function(){return 1===this._keys.length?this._keys[0]:null},Model.isAutoIncrement=function(){return this._autoIncrement},Model.addField=function(a,b){switch(b.type||(b={type:b}),"string"==typeof b.type&&(b.type=b.type.toUpperCase()),b.type){case"STRING":case String:b.type=this.FIELD_TYPE_TEXT;break;case Number:b.type=this.FIELD_TYPE_NUMERIC;break;case Date:b.type=this.FIELD_TYPE_TIMESTAMP;break;case"INT":b.type=this.FIELD_TYPE_INTEGER}if(b.key&&this._keys.push(a),b.computed&&(this._autoIncrement=!0),!this.isFieldType(b.type))throw new Error(b.type+" is not a valide field type");b.type.isModel&&this._relations.push(a),this._fields[a]=b},Model.extend=function(a,b){var c,d,e;if(b=b||{},"undefined"==typeof a)throw new Error("Must provide a table when exending Model");if(c=Class.extend.call(this,b.prototype),delete b.prototype,this._table||this._fields)c._keys=dabl.copy(this._keys),c._fields=dabl.copy(this._fields),c._relations=dabl.copy(this._relations);else{if(!b.fields)throw new Error("Must provide fields when exending Model");c._keys=[],c._fields={},c._relations=[]}c._table=a;for(e in b)switch(e){case"url":case"adapter":c["_"+e]=b[e];break;default:c[e]=b[e]}for(d in b.fields)c.addField(d,b.fields[d]);return Model.models[a]=c,c},Model.isModel=!0,Model.toString=function(){return this._table};for(var adapterMethods=["countAll","findAll","find","removeAll","updateAll"],i=0,l=adapterMethods.length;l>i;++i){var method=adapterMethods[i];Model[method]=function(a){return function(){for(var b=Array.prototype.slice.call(arguments),c=this.getAdapter(),d=null,e=null,f=b.length-1;f>-1&&!(b[f]instanceof Model)&&"function"==typeof b[f];){if(d){e=d,d=b.pop();break}d=b.pop(),--f}return b.unshift(this),this.callAsync(function(){return c[a].apply(c,b)},d,e)}}(method)}for(var findAliases=["findBy","retrieveByField","retrieveByPK","retrieveByPKs","findByPKs"],x=0,len=findAliases.length;len>x;++x)Model[findAliases[x]]=Model.find;dabl.Model=Model;var Condition=dabl.Class.extend({_conds:null,init:function(a,b,c,d){this._conds=[],0!==arguments.length&&this.and.apply(this,arguments)},_preprocessCondition:function(a,b,c,d){switch(arguments.length){case 0:return null;case 1:return a instanceof Query.Statement||a instanceof Condition&&0!==a._conds.length?[a]:null;case 2:c=b,b=Condition.EQUAL;case 3:d=Condition.QUOTE_RIGHT}var e=c instanceof Query,f=c instanceof Array;if(f||e){if(!1===e||1!==c.getLimit())switch(b){case Condition.BETWEEN:break;case Condition.IN:case Condition.EQUAL:case"eq":b=Condition.IN;break;case"ne":case Condition.NOT_IN:case Condition.NOT_EQUAL:case Condition.ALT_NOT_EQUAL:b=Condition.NOT_IN;break;default:throw new Error(b+" unknown for comparing an array.")}if(f&&0===c.length&&b===Condition.NOT_IN)return null;if(e){if(!c.getTable())throw new Error("right does not have a table, so it cannot be nested.");d!==Condition.QUOTE_LEFT&&(d=Condition.QUOTE_NONE)}}else null===c&&(b===Condition.NOT_EQUAL||b===Condition.ALT_NOT_EQUAL||"ne"===b?b=Condition.IS_NOT_NULL:(b===Condition.EQUAL||"eq"===b)&&(b=Condition.IS_NULL)),(b===Condition.IS_NULL||b===Condition.IS_NOT_NULL)&&(c=null,d!==Condition.QUOTE_LEFT&&(d=Condition.QUOTE_NONE));return[a,b,c,d]},_processCondition:function(a,b,c,d){if(1===arguments.length){if(a instanceof Query.Statement)return a;if(a instanceof Condition)return e=a.getQueryStatement(),e.setString("("+e._qString+")"),e}var e,f,g,h=new Query.Statement,i=c instanceof Query,j=c instanceof Array;if(!(b in Condition.SQL.operators))throw new Error('Unsupported SQL operator: "'+b+'"');if("substringof"===b){var k=a;a=c,c=k}if(b=Condition.SQL.operators[b],(d===Condition.QUOTE_LEFT||d===Condition.QUOTE_BOTH)&&(h.addParam(a),a="?"),b===Condition.CONTAINS?(b=Condition.LIKE,c="%"+c+"%"):b===Condition.BEGINS_WITH?(b=Condition.LIKE,c+="%"):b===Condition.ENDS_WITH&&(b=Condition.LIKE,c="%"+c),j||i){if(i)e=c.getQuery(),c="("+e._qString+")",h.addParams(e._params);else if(j){if(g=c.length,2===g&&b===Condition.BETWEEN)return h.setString(a+" "+b+" ? AND ?"),h.addParams(c),h;if(0===g){if(b===Condition.IN)return h.setString("(0 = 1)"),h}else if(d===Condition.QUOTE_RIGHT||d===Condition.QUOTE_BOTH){h.addParams(c);var l="(";for(f=0;g>f;++f)f>0&&(l+=","),l+="?";c=l+")"}}}else b===Condition.IS_NULL||b===Condition.IS_NOT_NULL||d!==Condition.QUOTE_RIGHT&&d!==Condition.QUOTE_BOTH||(h.addParam(c),c="?");return h.setString(a+" "+b+(null===c?"":" "+c)),h},prepareInput:function(a){if(a instanceof Array){a=a.slice(0);for(var b=0,c=a.length;c>b;++b)a[b]=this.prepareInput(a[b]);return a}return a===!0||a===!1?a?1:0:null===a||"undefined"==typeof a?"null":parseInt(a,10)===a?a:this.quote(a)},quote:function(a){return"'"+a.replace("'","''")+"'"},_processODataCondition:function(a,b,c,d){if(1===arguments.length){if(a instanceof Query.Statement)throw new Error("Unable to use Query.Statement within a Condition to build an OData query");if(a instanceof Condition)return"("+a.getODataFilter()+")"}if(c instanceof Query)throw new Error("Unable to use Query within a Condition to build an OData query");var e,f,g=c instanceof Array;switch((d===Condition.QUOTE_LEFT||d===Condition.QUOTE_BOTH)&&(a=this.prepareInput(a)),b){case"startswith":case"endswith":case"substringof":case Condition.LIKE:case Condition.CONTAINS:case Condition.BEGINS_WITH:case Condition.ENDS_WITH:if(-1!==c.indexOf("%"))throw new Error("Cannot use % in OData queries")}if(b===Condition.IS_NULL?(b=Condition.EQUAL,c="null"):b===Condition.IS_NOT_NULL?(b=Condition.NOT_EQUAL,c="null"):(d===Condition.QUOTE_RIGHT||d===Condition.QUOTE_BOTH)&&(c=this.prepareInput(c)),g){if(f=c.length,2===f&&b===Condition.BETWEEN)return"("+a+" ge "+c[0]+" and "+a+" le "+c[1]+")";if(0===f&&b===Condition.IN)return"(0 eq 1)";var h;b===Condition.IN?(b=" eq ",h=" or "):(b=" ne ",h=" and ");var i="(";for(e=0;f>e;++e)i+=(0!==e?h:"")+a+b+c[e];return i+")"}if(b in Condition.OData.operators)return b=Condition.OData.operators[b],a+" "+b+" "+c;if(b in Condition.OData.functions){var j=Condition.OData.functions[b],k=j.indexOf("@"),l=j.indexOf("?");return k>l?(j=j.substring(0,k)+c+j.substr(k+1),j=j.substring(0,l)+a+j.substr(l+1)):(j=j.substring(0,l)+a+j.substr(l+1),j=j.substring(0,k)+c+j.substr(k+1)),j}throw new Error("Unexpected arguments: "+arguments.join(", "))},and:function(a,b,c,d){var e;if(a.constructor===Object){for(e in a)this.and(e,a[e]);return this}var f=this._preprocessCondition.apply(this,arguments);return null===f?this:(f.type="AND",this._conds.push(f),this)},addAnd:function(a,b,c,d){return this.and.apply(this,arguments)},add:function(a,b,c,d){return this.and.apply(this,arguments)},filter:function(a,b,c,d){return this.and.apply(this,arguments)},where:function(a,b,c,d){return this.and.apply(this,arguments)},or:function(a,b,c,d){var e;if(a.constructor===Object){for(e in a)this.or(e,a[e]);return this}var f=this._preprocessCondition.apply(this,arguments);return null===f?this:(f.type="OR",this._conds.push(f),this)},addOr:function(a,b,c,d){return this.or.apply(this,arguments)},orWhere:function(a,b,c,d){return this.or.apply(this,arguments)},andNot:function(a,b){return this.and(a,Condition.NOT_EQUAL,b)},andLike:function(a,b){return this.and(a,Condition.LIKE,b)},andNotLike:function(a,b){return this.and(a,Condition.NOT_LIKE,b)},andGreater:function(a,b){return this.and(a,Condition.GREATER_THAN,b)},andGreaterEqual:function(a,b){return this.and(a,Condition.GREATER_EQUAL,b)},andLess:function(a,b){return this.and(a,Condition.LESS_THAN,b)},andLessEqual:function(a,b){return this.and(a,Condition.LESS_EQUAL,b)},andNull:function(a){return this.and(a,null)},andNotNull:function(a){return this.and(a,Condition.NOT_EQUAL,null)},andBetween:function(a,b,c){return this.and(a,Condition.BETWEEN,[b,c])},andBeginsWith:function(a,b){return this.and(a,Condition.BEGINS_WITH,b)},andEndsWith:function(a,b){return this.and(a,Condition.ENDS_WITH,b)},andContains:function(a,b){return this.and(a,Condition.CONTAINS,b)},orNot:function(a,b){return this.or(a,Condition.NOT_EQUAL,b)},orLike:function(a,b){return this.or(a,Condition.LIKE,b)},orNotLike:function(a,b){return this.or(a,Condition.NOT_LIKE,b)},orGreater:function(a,b){return this.or(a,Condition.GREATER_THAN,b)},orGreaterEqual:function(a,b){return this.or(a,Condition.GREATER_EQUAL,b)},orLess:function(a,b){return this.or(a,Condition.LESS_THAN,b)},orLessEqual:function(a,b){return this.or(a,Condition.LESS_EQUAL,b)},orNull:function(a){return this.or(a,null)},orNotNull:function(a){return this.or(a,Condition.NOT_EQUAL,null)},orBetween:function(a,b,c){return this.or(a,Condition.BETWEEN,[b,c])},orBeginsWith:function(a,b){return this.or(a,Condition.BEGINS_WITH,b)},orEndsWith:function(a,b){return this.or(a,Condition.ENDS_WITH,b)},orContains:function(a,b){return this.or(a,Condition.CONTAINS,b)},getQueryStatement:function(a){if(0===this._conds.length)return null;var b,c,d=new Query.Statement(a),e="",f=this._conds,g=f.length;for(b=0;g>b;++b)c=this._processCondition.apply(this,f[b]),null!==c&&(e+="\n	",0!==b&&(e+=(1===b&&"OR"===f[0].type?"OR":f[b].type)+" "),e+=c._qString,d.addParams(c._params));return d.setString(e),d},getODataFilter:function(){if(0===this._conds.length)return null;var a,b,c="",d=this._conds,e=d.length;for(a=0;e>a;++a)b=this._processODataCondition.apply(this,d[a]),null!==b&&(0!==a&&(c+=" "+(1===a&&"or"===d[0].type?"or":"OR"===d[a].type?"or":"and")+" "),c+=b);return c},toString:function(){return this.getQueryStatement().toString()},getSimpleJSON:function(){var a={};if(0===this._conds.length)return{};var b,c,d=this._conds,e=d.length;for(b=0;e>b;++b){var c=d[b];if("AND"!==c.type)throw new Error("OR conditions not supported.");2===c.length?a[c[0]]=c[1]:a[c[0]]=c[2]}return a}});Condition.EQUAL="=",Condition.NOT_EQUAL="<>",Condition.ALT_NOT_EQUAL="!=",Condition.GREATER_THAN=">",Condition.LESS_THAN="<",Condition.GREATER_EQUAL=">=",Condition.LESS_EQUAL="<=",Condition.LIKE="LIKE",Condition.BEGINS_WITH="BEGINS_WITH",Condition.ENDS_WITH="ENDS_WITH",Condition.CONTAINS="CONTAINS",Condition.NOT_LIKE="NOT LIKE",Condition.IN="IN",Condition.NOT_IN="NOT IN",Condition.IS_NULL="IS NULL",Condition.IS_NOT_NULL="IS NOT NULL",Condition.BETWEEN="BETWEEN",Condition.BINARY_AND="&",Condition.BINARY_OR="|",Condition.SQL={operators:{eq:"=",ne:"<>",gt:">",lt:"<",ge:">=",le:"<=","=":"=","<>":"<>","!=":"<>",">":">","<":"<",">=":">=","<=":"<=","&":"&","|":"|",startswith:"BEGINS_WITH",BEGINS_WITH:"BEGINS_WITH",endswith:"ENDS_WITH",ENDS_WITH:"BEGINS_WITH",substringof:"CONTAINS",CONTAINS:"CONTAINS",LIKE:"LIKE","NOT LIKE":"NOT LIKE",IN:"IN","NOT IN":"NOT IN","IS NULL":"IS NULL","IS NOT NULL":"IS NOT NULL",BETWEEN:"BETWEEN"}},Condition.OData={operators:{eq:"eq",ne:"ne",gt:"gt",lt:"lt",ge:"ge",le:"le","=":"eq","<>":"ne","!=":"ne",">":"gt","<":"lt",">=":"ge","<=":"le","&":"&","|":"|"},functions:{startswith:"startswith(?, @)",endswith:"endswith(?, @)",substringof:"substringof(@, ?)",BEGINS_WITH:"startswith(?, @)",ENDS_WITH:"endswith(?, @)",CONTAINS:"substringof(@, ?)",LIKE:"tolower(@) eq tolower(?)","NOT LIKE":"tolower(@) ne tolower(?)"}},Condition.QUOTE_LEFT=1,Condition.QUOTE_RIGHT=2,Condition.QUOTE_BOTH=3,Condition.QUOTE_NONE=4,dabl.Condition=Condition;var Query=Condition.extend({_action:"SELECT",_columns:null,_table:null,_tableAlias:null,_extraTables:null,_joins:null,_orders:null,_groups:null,_having:null,_limit:null,_offset:0,_distinct:!1,init:function(a,b){this._super(),this._columns=[],this._joins=[],this._orders=[],this._groups=[],a&&(a.constructor===Object?this.and(a):a&&this.setTable(a,b))},setDistinct:function(a){"undefined"==typeof a&&(a=!0),this._distinct=a===!0},setAction:function(a){switch(a){case"SELECT":case"DELETE":case"COUNT":break;default:throw new Error('"'+a+'" is not an allowed Query action.')}return this._action=a,this},getAction:function(){return this._action},addColumn:function(a){return this._columns.push(a),this},setColumns:function(a){return this._columns=a.slice(0),this},select:function(a){return this.setColumns.apply(this,arguments)},getColumns:function(){return this._columns},setGroups:function(a){return this._groups=a,this},getGroups:function(){return this._groups},setTable:function(a,b){if(a instanceof Query&&!b)throw new Error("The nested query must have an alias.");return b&&this.setAlias(b),this._table=a,this},from:function(a,b){return this.setTable.apply(this,arguments)},getTable:function(){return this._table},setAlias:function(a){return this._tableAlias=a,this},getAlias:function(){return this._tableAlias},addTable:function(a,b){if(a instanceof Query){if(!b)throw new Error("The nested query must have an alias.")}else"undefined"==typeof b&&(b=a);if(b===this._tableAlias||b===this._table)throw new Error('The alias "'+b+'" is is already in use');return null===this._extraTables&&(this._extraTables={}),this._extraTables[b]=a,this},addJoin:function(a,b,c){if(a instanceof Query.Join)return this._joins.push(a),this;if(null===b){if(c===Query.JOIN||c===Query.INNER_JOIN)return this.addTable(a),this;b="1 = 1"}return this._joins.push(new Query.Join(a,b,c)),this},join:function(a,b,c){return this.addJoin(a,b,c)},innerJoin:function(a,b){return this.addJoin(a,b,Query.INNER_JOIN)},leftJoin:function(a,b){return this.addJoin(a,b,Query.LEFT_JOIN)},rightJoin:function(a,b){return this.addJoin(a,b,Query.RIGHT_JOIN)},outerJoin:function(a,b){return this.addJoin(a,b,Query.OUTER_JOIN)},getJoins:function(){return this._joins},setJoins:function(a){return this._joins=a,this},groupBy:function(a){return this._groups.push(a),this},setHaving:function(a){if(null!==a&&!(a instanceof Condition))throw new Error("setHaving must be given an instance of Condition");return this._having=a,this},getHaving:function(){return this._having},orderBy:function(a,b){return this._orders.push(arguments),this},limit:function(a,b){if(a=parseInt(a),isNaN(a))throw new Error("Not a number");return this._limit=a,arguments.length>1&&this.setOffset(b),this},top:function(a,b){return this.limit.apply(this,arguments)},getLimit:function(){return this._limit},offset:function(a){if(a=parseInt(a),isNaN(a))throw new Error("Not a number.");return this._offset=a,this},skip:function(a){return this.offset.apply(this,arguments)},setPage:function(a){if(a=parseInt(a),isNaN(a))throw new Error("Not a number.");if(2>a)return this._offset=null,this;if(!this._limit)throw new Error("Cannot set page without first setting limit.");return this._offset=a*this._limit-this._limit,this},hasAggregates:function(){if(0!==this._groups.length)return!0;for(var a=0,b=this._columns.length;b>a;++a)if(-1!==this._columns[a].indexOf("("))return!0;return!1},needsComplexCount:function(){return this.hasAggregates()||null!==this._having||this._distinct},getQuery:function(a){"undefined"==typeof a&&(a=new SQLAdapter);var b,c,d,e,f,g,h,i,j,k=new Query.Statement(a);switch(b="",this._action){default:case Query.ACTION_COUNT:case Query.ACTION_SELECT:c=this.getColumnsClause(a),k.addParams(c._params),b+="SELECT "+c._qString;break;case Query.ACTION_DELETE:b+="DELETE"}if(d=this.getTablesClause(a),k.addParams(d._params),b+="\nFROM "+d._qString,0!==this._joins.length)for(e=0,f=this._joins.length;f>e;++e)g=this._joins[e],h=g.getQueryStatement(a),b+="\n	"+h._qString,k.addParams(h._params);if(i=this.getWhereClause(),null!==i&&(b+="\nWHERE "+i._qString,k.addParams(i._params)),0!==this._groups.length&&(b+="\nGROUP BY "+this._groups.join(", ")),null!==this.getHaving()&&(j=this.getHaving().getQueryStatement(),j&&(b+="\nHAVING "+j._qString,k.addParams(j._params))),this._action!==Query.ACTION_COUNT&&0!==this._orders.length)for(b+="\nORDER BY ",e=0,f=this._orders.length;f>e;++e){var l=this._orders[e][0],m=this._orders[e][1];null!==m&&"undefined"!=typeof m&&(l=l+" "+m),0!==e&&(b+=", "),b+=l}return null!==this._limit&&(a?b=a.applyLimit(b,this._offset,this._limit):b+="\nLIMIT "+(this._offset?this._offset+", ":"")+this._limit),this._action===Query.ACTION_COUNT&&this.needsComplexCount()&&(b="SELECT count(0)\nFROM ("+b+") a"),k.setString(b),k},getTablesClause:function(a){var b,c,d,e,f,g,h,i,j=this._table;if(!j)throw new Error("No table specified.");switch(b=new Query.Statement(a),c=this._tableAlias,j instanceof Query?(d=j.getQuery(a),f="("+d._qString+")"):(d=null,f=j),this._action){case Query.ACTION_COUNT:case Query.ACTION_SELECT:if(null!==d&&b.addParams(d._params),c&&(f=f+" AS "+c),null!==this._extraTables)for(e in this._extraTables)g=this._extraTables[e],g instanceof Query?(h=g.getQuery(a),i="("+h._qString+") AS "+e,b.addParams(h._params)):(i=g,e!==g&&(i=i+" AS "+e)),f=f+", "+i;b.setString(f);break;case Query.ACTION_DELETE:null!==d&&b.addParams(d._params),c&&(f=f+" AS "+c),b.setString(f)}return b},getColumnsClause:function(a){var b,c,d,e,f,g=this._table,h=new Query.Statement(a),i=this._tableAlias,j=this._action;if(j===Query.ACTION_DELETE)return h;if(!g)throw new Error("No table specified.");if(j===Query.ACTION_COUNT){if(!this.needsComplexCount())return h.setString("count(0)"),h;if(0!==this._groups.length)return h.setString(this._groups.join(", ")),h;if(!this._distinct&&null===this.getHaving()&&0!==this._columns.length){for(e=[],c=0,d=this._columns.length;d>c;++c)b=this._columns[c],-1!==b.indexOf("(")&&e.push(b);if(0!==e.length)return h.setString(e.join(", ")),h}}return f=0!==this._columns.length?this._columns.join(", "):i?i+".*":g+".*",this._distinct&&(f="DISTINCT "+f),h.setString(f),h},getWhereClause:function(a){return this.getQueryStatement(a)},toString:function(){return this._table||this.setTable("{UNSPECIFIED-TABLE}"),this.getQuery().toString()},getCountQuery:function(a){if(!this._table)throw new Error("No table specified.");return this.setAction(Query.ACTION_COUNT),this.getQuery(a)},getDeleteQuery:function(a){if(!this._table)throw new Error("No table specified.");return this.setAction(Query.ACTION_DELETE),
this.getQuery(a)},getSelectQuery:function(a){if(!this._table)throw new Error("No table specified.");return this.setAction(Query.ACTION_SELECT),this.getQuery(a)},getODataQuery:function(){if(this._joins&&0!==this._joins.length)throw new Error("JOINS cannot be exported.");if(this._extraTables&&0!==this._extraTables.length)throw new Error("Extra tables cannot be exported.");if(this._having&&0!==this._having.length)throw new Error("Having cannot be exported.");if(this._groups&&0!==this._groups.length)throw new Error("Grouping cannot be exported.");var a={};0!==this._columns.length&&(a.$select=this._columns.join(","));var b=this.getODataFilter();return b&&(a.$filter=b),this._limit&&(a.$top=this._limit,this._offset&&(a.$skip=this._offset)),this._orders&&0!==this._orders.length&&(a.$orderby=this._orders[0][0],this._orders[0][1]===Query.DESC&&(a.$orderby+=" desc")),a},getSimpleJSON:function(){if(this._joins&&0!==this._joins.length)throw new Error("JOINS cannot be exported.");if(this._extraTables&&0!==this._extraTables.length)throw new Error("Extra tables cannot be exported.");if(this._having&&0!==this._having.length)throw new Error("Having cannot be exported.");if(this._groups&&0!==this._groups.length)throw new Error("Grouping cannot be exported.");var a=this._super();return this._limit&&(a.limit=this._limit,this._offset&&(a.offset=this._offset,a.page=Math.floor(this._offset/this._limit)+1)),this._orders&&0!==this._orders.length&&(a.order_by=this._orders[0][0],this._orders[0][1]===Query.DESC&&(a.dir=Query.DESC)),this._action===Query.ACTION_COUNT&&(a.count_only=1),a}});Query.ACTION_COUNT="COUNT",Query.ACTION_DELETE="DELETE",Query.ACTION_SELECT="SELECT",Query.JOIN="JOIN",Query.LEFT_JOIN="LEFT JOIN",Query.RIGHT_JOIN="RIGHT JOIN",Query.INNER_JOIN="INNER JOIN",Query.OUTER_JOIN="OUTER JOIN",Query.ASC="ASC",Query.DESC="DESC",dabl.Query=Query;var isIdent=/^\w+\.\w+$/,Join=function(a,b,c){return arguments.length<3&&(c=Query.JOIN),a instanceof Query||b instanceof Condition||!isIdent.test(b)||!isIdent.test(a)?void this.setTable(a).setOnClause(b).setJoinType(c):(this._isLikePropel=!0,this._leftColumn=a,this._rightColumn=b,this._table=b.substring(0,b.indexOf(".")),void(this._joinType=c))};Join.prototype={_table:null,_alias:null,_onClause:null,_isLikePropel:!1,_leftColumn:null,_rightColumn:null,_joinType:Query.JOIN,toString:function(){return this.getTable()||this.setTable("{UNSPECIFIED-TABLE}"),this.getQueryStatement().toString()},setTable:function(a){var b=a.lastIndexOf(" "),c=-1===b?-1:a.toUpperCase().lastIndexOf(" AS ");return c!==b-3&&(c=-1),-1!==b&&(this.setAlias(a.substr(b+1)),a=a.substring(0,-1===c?b:c)),this._table=a,this},setAlias:function(a){return this._alias=a,this},setOnClause:function(a){return this._isLikePropel=!1,this._onClause=a,this},setJoinType:function(a){return this._joinType=a,this},getQueryStatement:function(a){var b,c,d=this._table,e=this._onClause,f=this._joinType,g=this._alias;return d instanceof Query?(b=d.getQuery(a),d="("+b._qString+")",b.setString("")):b=new Query.Statement(a),g&&(d+=" AS "+g),this._isLikePropel?e=this._leftColumn+" = "+this._rightColumn:null===e?e="1 = 1":e instanceof Condition&&(c=e.getQueryStatement(),e=c._qString,b.addParams(c.getParams())),""!==e&&(e="ON ("+e+")"),b.setString(f+" "+d+" "+e),b},getTable:function(){return this._table},getAlias:function(){return this._alias},getOnClause:function(){return this._isLikePropel?this._leftColumn+" = "+this._rightColumn:this._onClause},getJoinType:function(){return this._joinType}},dabl.Query.Join=Join;var Statement=function(a){this._params=[],a&&(this._conn=a)};Statement.embedParams=function(a,b,c){c&&(b=c.prepareInput(b));var d="?";if(a.split(d).length-1!==b.length)throw new Error("The number of occurances of "+d+" do not match the number of _params.");if(0===b.length)return a;var e,f,g=a.length,h=d.length;for(e=b.length-1;e>=0;--e){if(f=b[e],g=a.lastIndexOf(d,g),-1===g)throw new Error("The number of occurances of "+d+" do not match the number of _params.");a=a.substring(0,g)+f+a.substr(g+h)}return a},Statement.prototype={_qString:"",_params:null,_conn:null,setConnection:function(a){this._conn=a},getConnection:function(){return this._conn},setString:function(a){this._qString=a},getString:function(){return this._qString},addParams:function(a){this._params=this._params.concat(a)},setParams:function(a){this._params=a.slice(0)},addParam:function(a){this._params.push(a)},getParams:function(){return this._params.slice(0)},toString:function(){return Query.Statement.embedParams(this._qString,this._params.slice(0),this._conn)}},dabl.Query.Statement=Statement;var Adapter=dabl.Class.extend({_cache:null,init:function(){this._cache={}},cache:function(a,b,c){return this._cache[a]||(this._cache[a]={}),arguments.length<3?this._cache[a][b]?this._cache[a][b]:null:(this._cache[a][b]=c,this)},emptyCache:function(a){delete this._cache[a]},formatDate:function(a,b){return a?b&&b===dabl.Model.FIELD_TYPE_TIMESTAMP?this.formatDateTime(a):(a instanceof Date||(a=dabl.constructDate(a)),a.getUTCFullYear()+"-"+dabl.sPad(a.getUTCMonth()+1)+"-"+dabl.sPad(a.getUTCDate())):null},formatDateTime:function(a){return a?(a instanceof Date||(a=dabl.constructDate(a)),a.getFullYear()+"-"+dabl.sPad(a.getMonth()+1)+"-"+dabl.sPad(a.getDate())+" "+dabl.sPad(a.getHours())+":"+dabl.sPad(a.getMinutes())+":"+dabl.sPad(a.getSeconds())):null},findQuery:function(a){var b=Array.prototype.slice.call(arguments),c=(new Query).setTable(a.getTableName()),d=a.getKey();b.shift();var e=b.length;if(0===e)return c;if(1===e){if("object"==typeof b[0]){if(b[0]instanceof Query)return b[0].getTable()||b[0].setTable(a.getTableName()),b[0];c.and(b[0])}else if(d){var f=parseInt(b[0],10);isNaN(f)?c.and(d,b[0]):c.and(d,f)}}else{if(2!==e&&3!==e&&4!==e||"string"!=typeof b[0])throw new Error("Unknown arguments for find: ("+b.join(", ")+")");c.and.apply(c,b)}return c},find:function(a){throw new Error("find not implemented for this adapter")},findAll:function(a){throw new Error("findAll not implemented for this adapter")},countAll:function(a,b){throw new Error("countAll not implemented for this adapter")},removeAll:function(a,b){throw new Error("removeAll not implemented for this adapter")},insert:function(a){throw new Error("insert not implemented for this adapter")},update:function(a){throw new Error("update not implemented for this adapter")},remove:function(a){throw new Error("remove not implemented for this adapter")}});dabl.Adapter=Adapter,Route.prototype={url:function(a){var b,c,d=this,e=this.template;a=a||{};for(var f in this.urlParams)b="undefined"!=typeof a[f]||a.hasOwnProperty(f)?a[f]:d.defaults[f],"undefined"!=typeof b&&null!==b?(c=encodeUriSegment(b),e=e.replace(new RegExp(":"+f+"(\\W)","g"),c+"$1")):(e=e.replace(new RegExp("(/?):"+f+"(\\W)","g"),function(a,b,c){return"/"===c.charAt(0)?c:b+c}),e=("/"===e.charAt(0)&&"."===e.charAt(1)?"/":"")+e.replace("/.","."));return e},urlGet:function(a){var b=this.url(a);a=a||{},b=b.replace(/\/?#$/,"");var c=dabl.serialize(a);return b=b.replace(/\/*$/,""),b+(c.length?"?"+c:"")}};var RESTAdapter=dabl.Adapter.extend({_routes:{},_urlBase:"",init:function(a){this._super(),a&&(this._urlBase=a)},_getRoute:function(a){if(!a)throw new Error("Cannot create RESTful route for empty url.");return this._routes[a]?this._routes[a]:this._routes[a]=new Route(this._urlBase+a)},_getErrorCallback:function(a){return function(b,c,d){var e;try{e=b.responseText?JSON.parse(b.responseText):null}catch(f){e=null}var g=d||"Request failed.";e&&(e.error?g=e.error:e.errors&&(g=e.errors.join("\n"))),a.reject(g,e,b)}},_isValidResponseObject:function(a,b){var c=b.getKey();return"object"!=typeof a||a.error||a.errors&&0!==a.errors.length||c&&"undefined"==typeof a[c]?!1:!0},_save:function(a,b){var c,d,e=a.constructor,f=this._getRoute(e._url),g={},h=e.getKey(),i=this,j=dabl.Deferred(),k=this._getErrorCallback(j);for(c in e._fields){var l=e._fields[c];d=a[c],e.isTemporalType(l.type)&&(d=this.formatDate(d,l.type)),g[c]=d}return jQuery.ajax({url:f.url(g),type:"POST",data:JSON.stringify(g),contentType:"application/json;charset=utf-8",dataType:"json",headers:{"X-HTTP-Method-Override":b},success:function(b,c,d){return i._isValidResponseObject(b,e)?(a.fromJSON(b).resetModified().setNew(!1),h&&"undefined"!=typeof a[h]&&i.cache(e._table,a[h],a),void j.resolve(a)):void k(d,c,"Invalid response.")},error:k}),j.promise()},formatDateTime:function(a){if(!a)return null;a instanceof Date||(a=dabl.constructDate(a));var b=-a.getTimezoneOffset()/60;return b=(b>0?"+":"-")+dabl.sPad(Math.abs(b)),a.getFullYear()+"-"+dabl.sPad(a.getMonth()+1)+"-"+dabl.sPad(a.getDate())+" "+dabl.sPad(a.getHours())+":"+dabl.sPad(a.getMinutes())+":"+dabl.sPad(a.getSeconds())+" "+b+"00"},insert:function(a){return this._save(a,"POST")},update:function(a){if(!a.isModified()){var b=dabl.Deferred();return b.resolve(a),b.promise()}return this._save(a,"PUT")},remove:function(a){var b=a.constructor,c=this._getRoute(b._url),d=b.getKey(),e=this,f=dabl.Deferred(),g=this._getErrorCallback(f);return jQuery.ajax({url:c.url(a.toJSON()),type:"POST",data:{},contentType:"application/json;charset=utf-8",dataType:"json",headers:{"X-HTTP-Method-Override":"DELETE"},success:function(c,h,i){return c&&(c.error||c.errors&&c.errors.length)?void g(i,h,"Invalid response."):(d&&a[d]&&e.cache(b._table,a[d],null),void f.resolve(a))},error:g}),f.promise()},find:function(a,b){var c,d=this._getRoute(a._url),e={},f=null,g=dabl.Deferred(),h=this._getErrorCallback(g),i=this,j=a.getKey();if(!j||2!==arguments.length||"number"!=typeof b&&"string"!=typeof b)c=this.findQuery.apply(this,arguments),c.limit(1),e=c.getSimpleJSON();else{if(f=this.cache(a._table,b))return g.resolve(f),g.promise();e={},e[j]=b}return jQuery.get(d.urlGet(e),function(b,c,d){return i._isValidResponseObject(b,a)?(b instanceof Array&&(b=b.shift()),void g.resolve(a.inflate(b))):void h(d,c,"Invalid response.")}).fail(h),g.promise()},findAll:function(a){var b=this.findQuery.apply(this,arguments),c=this._getRoute(a._url),d=b.getSimpleJSON(),e=dabl.Deferred(),f=this._getErrorCallback(e);return jQuery.get(c.urlGet(d),function(b,c,d){return"object"!=typeof b||b.error||b.errors&&b.errors.length?void f(d,c,"Invalid response."):(b instanceof Array||(b=[b]),void e.resolve(a.inflateArray(b)))}).fail(f),e.promise()},countAll:function(a){var b=this.findQuery.apply(this,arguments).setAction(dabl.Query.ACTION_COUNT),c=this._getRoute(a._url),d=b.getSimpleJSON(),e=dabl.Deferred(),f=this._getErrorCallback(e);return jQuery.get(c.urlGet(d),function(a,b,c){var d=parseInt(a.total,10);return isNaN(d)||"object"!=typeof a||a.error||a.errors&&a.errors.length?void f(c,b,"Invalid response."):void e.resolve(d)}).fail(f),e.promise()}});dabl.RESTAdapter=RESTAdapter,angular.module("dabl",[]).factory("dabl",["$http","$q",function(a,b){dabl.Deferred=function(){var a=b.defer(),c=a.promise;return a.promise=function(){return c},a};var c=dabl.RESTAdapter.extend({$http:null,init:function(a){this._super(a)},_getErrorCallback:function(a){return function(b,c,d,e){var f="Request failed.";b&&(b.error?f=b.error:b.errors&&(f=b.errors.join("\n"))),a.reject(f,b,e)}},_save:function(c,d){var e,f,g=c.constructor,h=this._getRoute(g._url),i={},j=g.getKey(),k=this,l=b.defer(),m=this._getErrorCallback(l);for(e in g._fields){var n=g._fields[e];f=c[e],g.isTemporalType(n.type)&&(f=this.formatDate(f,n.type)),i[e]=f}return a({url:h.url(i),method:"POST",data:i,headers:{"X-HTTP-Method-Override":d}}).success(function(a,b,d,e){return k._isValidResponseObject(a,g)?(c.fromJSON(a).resetModified().setNew(!1),j&&"undefined"!=typeof c[j]&&k.cache(g._table,c[j],c),void l.resolve(c)):void m.apply(this,arguments)}).error(m),l.promise},update:function(a){if(!a.isModified()){var c=b.defer();return c.resolve(a),c.promise}return this._save(a,"PUT")},remove:function(c){var d=c.constructor,e=this._getRoute(d._url),f=d.getKey(),g=this,h=b.defer(),i=this._getErrorCallback(h);return a({url:e.url(c.toJSON()),method:"POST",data:{},headers:{"X-HTTP-Method-Override":"DELETE"}}).success(function(a,b,e,j){return a&&(a.error||a.errors&&a.errors.length)?void i.apply(this,arguments):(f&&c[f]&&g.cache(d._table,c[f],null),void h.resolve(c))}).error(i),h.promise},find:function(c,d){var e,f=this._getRoute(c._url),g={},h=null,i=b.defer(),j=this._getErrorCallback(i),k=this,l=c.getKey();if(!l||2!==arguments.length||"number"!=typeof d&&"string"!=typeof d)e=this.findQuery.apply(this,arguments),e.limit(1),g=e.getSimpleJSON();else{if(h=this.cache(c._table,d))return i.resolve(h),i.promise;g={},g[l]=d}return a.get(f.urlGet(g)).success(function(a,b,d,e){return k._isValidResponseObject(a,c)?(a instanceof Array&&(a=a.shift()),void i.resolve(c.inflate(a))):void j.apply(this,arguments)}).error(j),i.promise},findAll:function(c){var d=this.findQuery.apply(this,arguments),e=this._getRoute(c._url),f=d.getSimpleJSON(),g=b.defer(),h=this._getErrorCallback(g);return a.get(e.urlGet(f)).success(function(a,b,d,e){return"object"!=typeof a||a.error||a.errors&&a.errors.length?void h.apply(this,arguments):(a instanceof Array||(a=[a]),void g.resolve(c.inflateArray(a)))}).error(h),g.promise},countAll:function(c){var d=this.findQuery.apply(this,arguments).setAction(dabl.Query.ACTION_COUNT),e=this._getRoute(c._url),f=d.getSimpleJSON(),g=b.defer(),h=this._getErrorCallback(g);return a.get(e.urlGet(f)).success(function(a,b,c,d){var e=parseInt(a.total,10);return isNaN(e)||"object"!=typeof a||a.error||a.errors&&a.errors.length?void h.apply(this,arguments):void g.resolve(e)}).error(h),g.promise}});return dabl.AngularRESTAdapter=c,dabl}]),angular.module("dabl-api",["dabl"]),angular.module("dabl-api").service("Auth",["$rootScope","$localstorage",function(a,b){var c={},d=null;c.setLoggedInUser=function(a){d=a},c.setUser=function(e){var f=d;c.setLoggedInUser(e),null===f&&e&&e.id?a.$broadcast("dabl-auth.user.logged-in"):null===e&&a.$broadcast("dabl-auth.user.logged-out"),b.set("user",e)},c.getUser=function(){return d},c.getToken=function(){return d&&"undefined"!=typeof d.authentication_token?d.authToken:null},c.getEmail=function(){return d&&"undefined"!=typeof d.email?d.email:null},c.isLoggedIn=function(){return d&&"undefined"!=typeof d.email&&"undefined"!=typeof d.authToken},c.checkAuthorization=function(a){return!!("undefined"!=typeof a&&"undefined"!=typeof a.data&&"undefined"!=typeof a.data.bypassAuth&&a.data.bypassAuth||c.isLoggedIn())},c.globalAdminIsLoggedIn=function(){var a=c.getUser();return a&&1===a.type},c.projectManagerIsLoggedIn=function(){var a=c.getUser();return a&&2===a.type},c.reset=function(){c.setUser(null)},c.passwordIsValid=function(a){return a.length>=8&&a.match(/[A-Z]+/)&&a.match(/[a-z]+/)&&a.match(/[0-9]+/)};var e=b.get("user");return e&&c.setUser(e),c}]),angular.module("dabl-api").factory("httpInterceptor",["dablApiConfig","security","Auth","$q","$rootScope",function(a,b,c,d,e){function f(b){return a.headerName+a.hash+":"+b}function g(d){var e=Date.now()/1e3|0,g=b.getHMAC(a.secret,[d,e].join(",")),h={"X-Timestamp":e,Authorization:f(g)};return c.isLoggedIn()&&(h["X-Email"]=c.getUser().email,h["X-User-Token"]=c.getUser().authToken),h}return{request:function(a){var b=g(a.url);if("undefined"!=typeof a.headers["X-Timestamp"])return a;for(var c in b)a.headers[c]=b[c];return a},responseError:function(a){return e.$broadcast("dabl-api.response.error",a),d.reject(a)},generateHeaders:g}}]),angular.module("dabl-api").factory("$localstorage",["$window",function(a){return{get:function(b,c){var d=a.localStorage[b];return d?JSON.parse(d):c},set:function(b,c){a.localStorage[b]=JSON.stringify(c)},remove:function(b){return delete a.localStorage[b]}}}]),angular.module("dabl-api").factory("security",["jsSHA",function(a){var b={};if("undefined"==typeof a)throw new Error("jsSHA is not included");return b.getHMAC=function(b,c){var d=new a("SHA-512","TEXT");return d.setHMACKey(b,"TEXT"),d.update(c),d.getHMAC("HEX")},b.getHash=function(b,c){c=c||"SHA-512";var d=new a(c,"TEXT");return d.update(b),d.getHash("HEX")},b.encode64=function(a){return btoa(a)},b.decode64=function(a){return atob(a)},b}]),angular.module("dabl-api").factory("serverApi",["$q","$http","dablApiConfig",function(a,b,c){var d={makeRequest:function(d,e,f,g){e=e||"",f=f?f.toUpperCase():""===e?"GET":"POST","/"===d.charAt(0)&&(d=d.substring(1));var h=a.defer(),i={method:f,url:c.baseUrl+"/"+d,data:e,timeout:h.promise};"undefined"!=typeof g&&(i.headers={"Content-Type":g});var j=b(i).then(function(a){return a.data},function(b){return a.reject(b)});return j.abort=function(){h.resolve()},j["finally"](function(){j.abort=angular.noop,h=j=null}),j},serialize:function(a,b){var c=[];for(var e in a)if(a.hasOwnProperty(e)){var f=b?b+"["+e+"]":e,g=a[e];c.push("object"==typeof g?d.serialize(g,f):encodeURIComponent(f)+"="+encodeURIComponent(g))}return c.join("&")},unserialize:function(a){var b={},c=a.split("&");return angular.forEach(c,function(a){if(!(a.length<1)){var c=a.split("=");if(-1!==c[0].indexOf("[")){var d,e,f=c[0].indexOf("["),g=c[0].indexOf("]");++f,g-=f,e=c[0].substr(0,f-1),d=c[0].substr(f,g),"undefined"==typeof b[e]&&(b[e]={}),b[e][d]=c[1]}else b[decodeURIComponent(c[0])]=decodeURIComponent(c[1])}}),b}};return d}]),angular.module("dabl-api").factory("siteUrl",["dablApiConfig",function(a){var b=16;return function(c,d){return c=c||"",-1===c.indexOf("http://")&&-1===c.indexOf("https://")&&(c=a.baseUrl+"/"+(c?c:"")),d&&(c+="?v="+b),c}}]),angular.module("dabl-api").service("userApi",["security","serverApi",function(a,b){var c={},d="users";return c.signIn=function(c,e){var f=d+"/login",g="application/x-www-form-urlencoded",h="credentials="+a.encode64([c,e].join(":"));return b.makeRequest(f,h,"post",g)},c.signOut=function(){var a=d+"/login/logout";return b.makeRequest(a,null,"get")},c}]);